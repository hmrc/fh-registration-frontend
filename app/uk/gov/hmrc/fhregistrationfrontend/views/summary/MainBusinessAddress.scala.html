@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.fhregistrationfrontend.forms.models
@import uk.gov.hmrc.fhregistrationfrontend.views.helpers._
@import uk.gov.hmrc.fhregistrationfrontend.views.html.helpers._
@import uk.gov.hmrc.fhregistrationfrontend.views.Mode
@import uk.gov.hmrc.fhregistrationfrontend.views.Mode.Mode
@import uk.gov.hmrc.fhregistrationfrontend.views.summary.GroupRow
@import uk.gov.hmrc.fhregistrationfrontend.views.ViewHelpers
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.fhregistrationfrontend.views.helpers.Helpers

@(mainBusinessAddressForm: models.MainBusinessAddress, mode: Mode)(implicit messages: Messages, viewHelpers: ViewHelpers)

@isGroupHead = @{
    if (mainBusinessAddressForm.timeAtCurrentAddress == "Less than 3 years") GroupRow.Top else GroupRow.Single
}

<div class="govuk-body govuk-body-s">
    <h2><strong>@{Messages("fh.main_business_address.title")}</strong></h2>
</div>

@mainBusinessAddress = @{Seq(Helpers.createSummaryRow(SummaryRowParams.ofString(
        Some(Messages("fh.mainBusinessAddress.summary.yearsAtAddress")),
        mainBusinessAddressForm.timeAtCurrentAddress,
        None,
        isGroupHead
    ), Helpers.createChangeLink(
    Mode isEditable mode,
    "mainBusinessAddress",
    Text("Change"),
    Some(Messages("fh.mainBusinessAddress.summary.yearsAtAddress"))
)))}

    @addressLessThanThreeYears = @{
        val hasPreviousAddress = mainBusinessAddressForm.hasPreviousAddress
        val optPreviousAddress = mainBusinessAddressForm.previousAddress

        (mainBusinessAddressForm.previousAddress.isDefined, optPreviousAddress) match {
          case (false, _) => Seq(
            Helpers.createSummaryRow(
              SummaryRowParams.ofString(
                Some(Messages("fh.mainBusinessAddress.summary.yearsAtAddress")),
                mainBusinessAddressForm.timeAtCurrentAddress,
                None,
                isGroupHead
                ),
              None
            )
          )
          case (true, Some(previousAddress)) => Seq(
            Helpers.createSummaryRow(
              SummaryRowParams.ofString(
                Some(Messages("fh.mainBusinessAddress.summary.previousAddress")),
                Helpers.findAddress(previousAddress),
                None,
                GroupRow.Member
              ),
              None
            ),
            Helpers.createSummaryRow(
              SummaryRowParams.ofDate(
                Some(Messages("fh.mainBusinessAddress.summary.previousAddressStartdate")),
                mainBusinessAddressForm.previousAddressStartdate,
                None,
                GroupRow.Bottom
              ),
            None
            )
          )
          case (true, _) => Seq(
            Helpers.createSummaryRow(
              SummaryRowParams.ofDate(
                Some(Messages("fh.mainBusinessAddress.summary.previousAddressStartdate")),
                mainBusinessAddressForm.previousAddressStartdate,
                None,
                GroupRow.Bottom
              ),
              None
            )
          )
          case _ => Seq.empty
        }
    }

<!--    conditionalRows = {-->
<!--        if(mainBusinessAddressForm.timeAtCurrentAddress == "Less than 3 years") {-->

<!--            val noPreviousAddress = if(mainBusinessAddressForm.hasPreviousAddress.contains(false)) {-->
<!--                Some(Helpers.createSummaryRow(SummaryRowParams.ofString(-->
<!--                    Some(Messages("fh.mainBusinessAddress.summary.yearsAtAddress")),-->
<!--                    mainBusinessAddressForm.timeAtCurrentAddress,-->
<!--                    None,-->
<!--                    isGroupHead-->
<!--                ), None))-->
<!--            } else None-->

<!--            val fullPreviousAddress: Seq[Option[SummaryListRow]] = if(mainBusinessAddressForm.hasPreviousAddress.contains(true)) {-->
<!--                Seq(-->
<!--                    mainBusinessAddressForm.previousAddress.map(add => Helpers.createSummaryRow(-->
<!--                    SummaryRowParams.ofString(-->
<!--                        Some(Messages("fh.mainBusinessAddress.summary.previousAddress")),-->
<!--                        Helpers.findAddress(mainBusinessAddressForm.previousAddress),-->
<!--                        None,-->
<!--                        GroupRow.Member-->
<!--                    ), None-->
<!--                )),-->
<!--                    Some(Helpers.createSummaryRow(SummaryRowParams.ofDate(-->
<!--                        Some(Messages("fh.mainBusinessAddress.summary.previousAddressStartdate")),-->
<!--                        mainBusinessAddressForm.previousAddressStartdate,-->
<!--                        None,-->
<!--                        GroupRow.Bottom-->
<!--                    ), None))-->
<!--                )-->
<!--            } else Seq.empty-->

<!--            Some(( noPreviousAddress +: fullPreviousAddress ).filter(_.isDefined).flatten)-->
<!--        } else None-->
<!--    }-->

@viewHelpers.govukSummaryList(
    SummaryList(
        rows = if(mainBusinessAddressForm.timeAtCurrentAddress == "Less than 3 years") {
          mainBusinessAddress
        } else {
          mainBusinessAddress ++ addressLessThanThreeYears
        }
    )
)